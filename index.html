<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CHF/JPY Trading Signal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
      background-color: #f0f0f0;
      margin: 0;
    }
    h1 {
      margin-bottom: 20px;
    }
    .signal {
      font-size: 2em;
      font-weight: bold;
      margin-top: 20px;
    }
    .buy {
      color: green;
    }
    .sell {
      color: red;
    }
    .no-entry {
      color: gray;
    }
    .loading {
      color: #555;
    }
    .price-info {
      margin-top: 20px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>CHF/JPY Trading Signal</h1>
  <div class="signal loading" id="signal">Loading...</div>
  <div class="price-info" id="price">CHF/JPY: --</div>

  <script>
    const API_KEY = 'ac495344588e48168833eccf2a40efdb'; // Replace with your real API key
    const REFRESH_INTERVAL = 300_000; // 5 minutes

    async function fetchMarketData(symbol) {
      try {
        const response = await fetch(`https://api.twelvedata.com/time_series?symbol=${symbol}&interval=5min&apikey=${API_KEY}&outputsize=14`);
        const data = await response.json();
        if (!data || !data.values) {
          console.error("Error fetching data:", data);
          return null;
        }
        return data.values; // Returns an array of price data
      } catch (error) {
        console.error("API Fetch Error:", error);
        return null;
      }
    }

    function calculateRSI(prices, period = 14) {
      let gains = 0, losses = 0;
      for (let i = 1; i < period; i++) {
        let change = prices[i - 1] - prices[i];
        if (change > 0) {
          gains += change;
        } else {
          losses -= change;
        }
      }
      if (losses === 0) return 100; // Strong buy signal
      let RS = gains / losses;
      return 100 - (100 / (1 + RS));
    }

    function calculateMovingAverage(prices, period) {
      let sum = prices.slice(0, period).reduce((a, b) => a + b, 0);
      return sum / period;
    }

    async function updateSignal() {
      const signalElement = document.getElementById('signal');
      const priceElement = document.getElementById('price');

      signalElement.className = 'signal loading';
      signalElement.textContent = 'Loading...';

      const marketData = await fetchMarketData('CHF/JPY');

      if (!marketData) {
        signalElement.className = 'signal no-entry';
        signalElement.textContent = 'No Entry (API Error)';
        return;
      }

      const prices = marketData.map(data => parseFloat(data.close));

      if (prices.length < 14) {
        signalElement.className = 'signal no-entry';
        signalElement.textContent = 'No Entry (Not Enough Data)';
        return;
      }

      const currentPrice = prices[0];
      const shortMA = calculateMovingAverage(prices, 5);
      const longMA = calculateMovingAverage(prices, 14);
      const rsi = calculateRSI(prices, 14);

      priceElement.textContent = `CHF/JPY: ${currentPrice.toFixed(3)}`;

      if (shortMA > longMA && rsi < 30) {
        signalElement.className = 'signal buy';
        signalElement.textContent = 'Buy';
      } else if (shortMA < longMA && rsi > 70) {
        signalElement.className = 'signal sell';
        signalElement.textContent = 'Sell';
      } else {
        signalElement.className = 'signal no-entry';
        signalElement.textContent = 'No Entry';
      }
    }

    updateSignal();
    setInterval(updateSignal, REFRESH_INTERVAL);
  </script>
</body>
</html>
