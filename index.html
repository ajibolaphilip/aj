<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHF/JPY Signal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
        }
        h2 {
            font-size: 30px;
            font-weight: bold;
            margin-top: 20px;
        }
        .buy {
            color: green;
        }
        .sell {
            color: red;
        }
        .strong-buy {
            color: darkgreen;
            font-size: 20px;
            font-weight: bold;
        }
        .strong-sell {
            color: darkred;
            font-size: 20px;
            font-weight: bold;
        }
        .no-entry {
            color: gray;
        }
    </style>
</head>
<body>
    <h1>CHF/JPY Signal</h1>
    <h2 id="signal" class="no-entry">Loading...</h2>
    <p id="strong-signal"></p> <!-- Strong buy/sell message -->
    <p id="price">CHF/JPY: --</p>
    <p id="time">Last Update: --</p>
    <p id="trend-2min">2-Minute Trend: --</p>

    <script>
        let priceHistory = []; // Stores last 24 updates (2 minutes)
        const requiredUpdates = 24; // 24 updates = 2 minutes (5s interval)
        let lastConfirmedSignal = "No Entry"; // Stores the last confirmed Buy/Sell signal

        function fetchLivePrice() {
            // Simulated live price (replace with actual API fetch)
            let price = (167.7 + Math.random() * 0.8).toFixed(3); // Random price for demo
            
            document.getElementById('price').innerText = "CHF/JPY: " + price;
            document.getElementById('time').innerText = "Last Update: " + new Date().toLocaleTimeString();
            
            // Store the price history
            priceHistory.push(parseFloat(price));
            if (priceHistory.length > requiredUpdates) {
                priceHistory.shift(); // Keep only last 2 minutes of data
            }

            let signalElement = document.getElementById('signal');
            let strongSignalElement = document.getElementById('strong-signal');
            let trend2MinElement = document.getElementById('trend-2min');

            let { signal, strongSignal, trendDirection } = determineSignal(priceHistory);

            // Show the 2-minute trend
            if (trendDirection > 0) {
                trend2MinElement.innerText = "2-Minute Trend: Up";
                trend2MinElement.className = "buy";
            } else if (trendDirection < 0) {
                trend2MinElement.innerText = "2-Minute Trend: Down";
                trend2MinElement.className = "sell";
            } else {
                trend2MinElement.innerText = "2-Minute Trend: Neutral";
                trend2MinElement.className = "no-entry";
            }

            // Ensure Buy/Sell signal only changes if trend remains in the same direction
            if (signal !== "No Entry" && (lastConfirmedSignal === "No Entry" || signal === lastConfirmedSignal)) {
                lastConfirmedSignal = signal; // Confirm the new signal

                if (signal === "Buy") {
                    signalElement.innerText = "BUY";
                    signalElement.className = "buy";
                } else if (signal === "Sell") {
                    signalElement.innerText = "SELL";
                    signalElement.className = "sell";
                }
            }

            if (strongSignal === "Strong Buy") {
                strongSignalElement.innerText = "Strong Buy";
                strongSignalElement.className = "strong-buy";
            } else if (strongSignal === "Strong Sell") {
                strongSignalElement.innerText = "Strong Sell";
                strongSignalElement.className = "strong-sell";
            } else {
                strongSignalElement.innerText = ""; // Clear strong signal if none
            }
        }

        function determineSignal(priceHistory) {
            if (priceHistory.length < requiredUpdates) {
                return { signal: "No Entry", strongSignal: "", trendDirection: 0 };
            }

            let latestPrice = priceHistory[priceHistory.length - 1];
            let oldestPrice = priceHistory[0];
            let trendDirection = latestPrice - oldestPrice; // Trend over last 2 minutes

            let signal = "No Entry";
            let strongSignal = "";

            if (latestPrice > 168.1) {
                signal = "Buy";
                if (trendDirection > 0.1) { // Confirm strong uptrend
                    strongSignal = "Strong Buy";
                }
            } else if (latestPrice < 167.9) {
                signal = "Sell";
                if (trendDirection < -0.1) { // Confirm strong downtrend
                    strongSignal = "Strong Sell";
                }
            }

            return { signal, strongSignal, trendDirection };
        }

        // Fetch data every 5 seconds
        fetchLivePrice();
        setInterval(fetchLivePrice, 5000);
    </script>
</body>
</html>
