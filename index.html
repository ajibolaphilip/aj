<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHF/JPY Signal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
        }
        h2 {
            font-size: 30px;
            font-weight: bold;
            margin-top: 20px;
        }
        .buy {
            color: green;
        }
        .sell {
            color: red;
        }
        .strong-buy {
            color: darkgreen;
            font-size: 20px;
            font-weight: bold;
        }
        .strong-sell {
            color: darkred;
            font-size: 20px;
            font-weight: bold;
        }
        .no-entry {
            color: gray;
        }
    </style>
</head>
<body>
    <h1>CHF/JPY Signal</h1>
    <h2 id="signal" class="no-entry">Loading...</h2>
    <p id="strong-signal"></p> <!-- Strong buy/sell message -->
    <p id="price">CHF/JPY: --</p>
    <p id="entry">2 Min Entry: --</p>
    <p id="last-update">Last Update: --</p>
    <p id="live-time">Live Time: --</p>

    <script>
        const API_KEY = "i7IqoBCbFx3zPFLLBluhrvRvo";
        const API_URL = `https://fcsapi.com/api-v3/forex/latest?id=57&access_key=${API_KEY}`; // CHF/JPY ID = 57

        let entryPrice = null; // Store 2-minute entry price
        let confirmTrendTime = 0; // Track confirmation time for strong signal

        function fetchLivePrice() {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    if (data && data.response && data.response[0]) {
                        let price = parseFloat(data.response[0].c); // Current CHF/JPY price
                        updateDisplay(price);
                    } else {
                        console.error("Invalid API response:", data);
                    }
                })
                .catch(error => console.error("Error fetching price:", error));
        }

        function updateDisplay(price) {
            let signalElement = document.getElementById("signal");
            let strongSignalElement = document.getElementById("strong-signal");

            document.getElementById("price").innerText = `CHF/JPY: ${price.toFixed(3)}`;
            document.getElementById("last-update").innerText = `Last Update: ${new Date().toLocaleTimeString()}`;

            // Set 2-min entry price (if not set yet or every 2 min)
            if (!entryPrice || confirmTrendTime % 24 === 0) { // 24 updates = 2 minutes (5 sec per update)
                entryPrice = price;
                document.getElementById("entry").innerText = `2 Min Entry: ${entryPrice.toFixed(3)}`;
            }

            let { signal, strongSignal } = determineSignal(price, entryPrice);

            // Update main signal
            if (signal === "Buy") {
                signalElement.innerText = "BUY";
                signalElement.className = "buy";
            } else if (signal === "Sell") {
                signalElement.innerText = "SELL";
                signalElement.className = "sell";
            } else {
                signalElement.innerText = "No Entry";
                signalElement.className = "no-entry";
            }

            // Strong buy/sell logic (only show if trend continues for 1 minute)
            if (strongSignal !== "" && confirmTrendTime >= 12) { // 12 updates = 1 minute
                strongSignalElement.innerText = strongSignal;
                strongSignalElement.className = strongSignal === "Strong Buy" ? "strong-buy" : "strong-sell";
                alert(`${strongSignal} Signal Confirmed!`);
            } else {
                strongSignalElement.innerText = "";
            }

            // Increase confirmation timer
            confirmTrendTime++;
        }

        function determineSignal(price, entryPrice) {
            let signal = "No Entry";
            let strongSignal = "";

            let indicators = {
                MA: price > entryPrice, // Moving Average Trend
                RSI: price % 2 === 0,   // Dummy RSI condition
                MACD: price % 3 === 0   // Dummy MACD condition
            };

            let validIndicators = Object.values(indicators).filter(Boolean).length; // Count true indicators

            if (validIndicators >= 3) {
                if (price > entryPrice) {
                    signal = "Buy";
                    if (price > entryPrice + 0.1) strongSignal = "Strong Buy"; // Adjust for real calculation
                } else {
                    signal = "Sell";
                    if (price < entryPrice - 0.1) strongSignal = "Strong Sell"; // Adjust for real calculation
                }
            }

            return { signal, strongSignal };
        }

        function updateLiveTime() {
            document.getElementById("live-time").innerText = `Live Time: ${new Date().toLocaleTimeString()}`;
        }

        // Fetch new price every 5 seconds
        fetchLivePrice();
        setInterval(fetchLivePrice, 5000);

        // Update live clock every second
        updateLiveTime();
        setInterval(updateLiveTime, 1000);
    </script>
</body>
</html>
