<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHF/JPY Signal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            font-size: 24px;
        }
        h2 {
            font-size: 30px;
            font-weight: bold;
            margin-top: 20px;
        }
        .buy {
            color: green;
        }
        .sell {
            color: red;
        }
        .strong-buy {
            color: darkgreen;
            font-size: 20px;
            font-weight: bold;
        }
        .strong-sell {
            color: darkred;
            font-size: 20px;
            font-weight: bold;
        }
        .no-entry {
            color: gray;
        }
        .timer {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>CHF/JPY Signal</h1>
    <h2 id="signal" class="no-entry">Loading...</h2>
    <p id="strong-signal"></p> <!-- Strong buy/sell message -->
    <p id="price">CHF/JPY: --</p>
    <p id="entry">2-Min Entry Price: --</p>
    <p id="time">Last Update: --</p>
    <p class="timer" id="countdown">Next update in: 5s</p>

    <script>
        const API_KEY = 'ac495344588e48168833eccf2a40efdb'; // Your Twelve Data API key
        let refreshInterval = 5; // Refresh every 5 seconds
        let countdown = refreshInterval;

        async function fetchLiveData() {
            try {
                const response = await fetch(`https://api.twelvedata.com/time_series?symbol=CHF/JPY&interval=1min&outputsize=3&apikey=${API_KEY}`);
                const data = await response.json();

                if (data.values) {
                    const prices = data.values.map(v => parseFloat(v.close));
                    const currentPrice = prices[0]; // Latest price
                    const entryPrice = prices[2]; // Price from 2 minutes ago

                    document.getElementById('price').innerText = "CHF/JPY: " + currentPrice.toFixed(3);
                    document.getElementById('entry').innerText = "2-Min Entry Price: " + entryPrice.toFixed(3);
                    document.getElementById('time').innerText = "Last Update: " + new Date().toLocaleTimeString();

                    updateSignal(currentPrice, entryPrice);
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        function updateSignal(currentPrice, entryPrice) {
            let signalElement = document.getElementById('signal');
            let strongSignalElement = document.getElementById('strong-signal');

            // Get indicator confirmations
            let confirmations = calculateIndicators(currentPrice);

            let signal = "No Entry";
            let strongSignal = "";

            if (confirmations >= 3) {
                if (currentPrice > entryPrice) {
                    signal = "Buy";
                    if (confirmations >= 5) strongSignal = "Strong Buy";
                } else if (currentPrice < entryPrice) {
                    signal = "Sell";
                    if (confirmations >= 5) strongSignal = "Strong Sell";
                }
            }

            // Update display
            signalElement.innerText = signal;
            signalElement.className = signal.toLowerCase().replace(" ", "-");

            strongSignalElement.innerText = strongSignal ? strongSignal : "";
            strongSignalElement.className = strongSignal ? strongSignal.toLowerCase().replace(" ", "-") : "";

        }

        function calculateIndicators(price) {
            // Simulated indicator logic for now
            let confirmations = 0;

            // Dummy logic for 7 indicators (Replace with real calculations)
            let movingAverage = price > 168.0 ? 1 : 0;
            let rsi = price > 167.8 ? 1 : 0;
            let macd = price > 167.9 ? 1 : 0;
            let bollinger = price > 168.1 ? 1 : 0;
            let supportResistance = price > 167.85 ? 1 : 0;
            let volume = price > 167.7 ? 1 : 0;
            let stochastic = price > 167.6 ? 1 : 0;

            confirmations = movingAverage + rsi + macd + bollinger + supportResistance + volume + stochastic;
            return confirmations;
        }

        function startCountdown() {
            countdown = refreshInterval;
            setInterval(() => {
                countdown--;
                document.getElementById("countdown").innerText = `Next update in: ${countdown}s`;
                if (countdown <= 0) {
                    countdown = refreshInterval;
                }
            }, 1000);
        }

        // Auto-refresh every 5 seconds
        fetchLiveData();
        setInterval(fetchLiveData, refreshInterval * 1000);
        startCountdown();

    </script>
</body>
</html>
