<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHF/JPY Signal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
        }
        h2 {
            font-size: 30px;
            font-weight: bold;
            margin-top: 20px;
        }
        .buy {
            color: green;
        }
        .sell {
            color: red;
        }
        .strong-buy {
            color: darkgreen;
            font-size: 20px;
            font-weight: bold;
        }
        .strong-sell {
            color: darkred;
            font-size: 20px;
            font-weight: bold;
        }
        .no-entry {
            color: gray;
        }
    </style>
</head>
<body>
    <h1>CHF/JPY Signal</h1>
    <h2 id="signal" class="no-entry">Loading...</h2>
    <p id="strong-signal"></p> <!-- Strong buy/sell message -->
    <p id="price">CHF/JPY: --</p>
    <p id="entry-2min">2-Min Entry: --</p>
    <p id="time">Last Update: --</p>

    <script>
        const API_KEY = "ac495344588e48168833eccf2a40efdb"; // Your Twelve Data API Key
        const SYMBOL = "CHF/JPY";
        const INTERVAL = "1min";  // Fetch data every 1 minute
        const REFRESH_INTERVAL = 60000; // Refresh every 1 minute

        async function fetchIndicators() {
            try {
                const url = `https://api.twelvedata.com/time_series?symbol=${SYMBOL}&interval=${INTERVAL}&apikey=${API_KEY}&outputsize=3`;
                const response = await fetch(url);
                const data = await response.json();

                if (data && data.values) {
                    const candles = data.values.map(v => parseFloat(v.close));
                    if (candles.length < 3) return null;

                    return {
                        current: candles[0],
                        previous1: candles[1],  // 1 min ago
                        previous2: candles[2]   // 2 min ago
                    };
                }
            } catch (error) {
                console.error("API fetch error:", error);
                return null;
            }
        }

        async function fetchTechnicalIndicators() {
            try {
                const url = `https://api.twelvedata.com/quote?symbol=${SYMBOL}&apikey=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();

                if (!data) return null;

                return {
                    price: parseFloat(data.close),
                    rsi: parseFloat(data.rsi),  // Relative Strength Index
                    macd: parseFloat(data.macd), // MACD
                    stochastic: parseFloat(data.stochastic_k), // Stochastic
                    bollinger: parseFloat(data.bollinger_lower) < data.close && data.close < parseFloat(data.bollinger_upper),
                    volume: parseFloat(data.volume),
                    support: parseFloat(data.support),  // Support Level
                    resistance: parseFloat(data.resistance)  // Resistance Level
                };
            } catch (error) {
                console.error("API fetch error:", error);
                return null;
            }
        }

        async function updateSignal() {
            const indicatorData = await fetchIndicators();
            const techData = await fetchTechnicalIndicators();

            if (!indicatorData || !techData) {
                document.getElementById('signal').innerText = "No Entry";
                return;
            }

            const { current, previous1, previous2 } = indicatorData;
            document.getElementById('price').innerText = `CHF/JPY: ${current.toFixed(3)}`;
            document.getElementById('entry-2min').innerText = `2-Min Entry: ${previous2.toFixed(3)}`;
            document.getElementById('time').innerText = `Last Update: ${new Date().toLocaleTimeString()}`;

            let signal = "No Entry";
            let strongSignal = "";

            // 7-indicator confirmation
            let buyConditions = (
                techData.rsi > 50 &&
                techData.macd > 0 &&
                techData.stochastic > 50 &&
                techData.bollinger &&
                current > techData.support &&
                current > previous1 && previous1 > previous2
            );

            let sellConditions = (
                techData.rsi < 50 &&
                techData.macd < 0 &&
                techData.stochastic < 50 &&
                !techData.bollinger &&
                current < techData.resistance &&
                current < previous1 && previous1 < previous2
            );

            if (buyConditions) {
                signal = "Buy";
                if (current > previous2 * 1.0015) {
                    strongSignal = "Strong Buy"; // Ensures trend continuation for 1-2 minutes
                }
            } else if (sellConditions) {
                signal = "Sell";
                if (current < previous2 * 0.9985) {
                    strongSignal = "Strong Sell";
                }
            }

            let signalElement = document.getElementById('signal');
            let strongSignalElement = document.getElementById('strong-signal');

            if (signal === "Buy") {
                signalElement.innerText = "BUY";
                signalElement.className = "buy";
            } else if (signal === "Sell") {
                signalElement.innerText = "SELL";
                signalElement.className = "sell";
            } else {
                signalElement.innerText = "No Entry";
                signalElement.className = "no-entry";
            }

            if (strongSignal === "Strong Buy") {
                strongSignalElement.innerText = "Strong Buy";
                strongSignalElement.className = "strong-buy";
            } else if (strongSignal === "Strong Sell") {
                strongSignalElement.innerText = "Strong Sell";
                strongSignalElement.className = "strong-sell";
            } else {
                strongSignalElement.innerText = "";
            }
        }

        updateSignal();
        setInterval(updateSignal, REFRESH_INTERVAL);
    </script>
</body>
</html>
